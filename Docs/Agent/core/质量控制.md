# 质量控制：思维链协议与防御性编程

> 📖 **文档索引**: 返回 [AI 辅助开发规范文档索引](../文档索引.md)

## 思维链协议 (CoT Protocol)

### 核心价值

将架构原则转化为可执行的检查清单，防止 AI 使用"常见但错误"的模式，在代码生成阶段捕获架构违规。

### 差异化策略：S/M/L 三级 CoT 协议

根据领域风险采用不同力度：

**🔥 L 级 (Large - 必须有，且详细)**
- **适用场景**: 高风险领域（运行时安全、渲染性能、并发控制等）
- **协议内容**: 运行时安全（状态检查、序列化边界、生命周期管理）、渲染性能（层级数量、重绘范围、性能预算）

**🛡️ M 级 (Medium - 推荐有，聚焦边界)**
- **适用场景**: 架构约束、数据一致性、依赖管理
- **协议内容**: 确认层级归属、依赖方向、单一真理源原则

**⚡ S 级 (Small - 可以简化或省略)**
- **适用场景**: 工程配置、文档维护、测试代码
- **策略**: 无需强制 CoT，遵循代码风格即可

### CoT 设计原则

1. **检查单思维**: 每个检查项对应一个具体的风险点
2. **量化指标**: 使用具体数字（如 "Layer Count > 10"、"Memory > 1MB"）而非模糊描述
3. **差异化策略**: 高风险领域详细分析，低风险领域简化或省略

## 防御性禁令 (Critical Prohibitions)

**核心原则**: 提供明确的 Negative Constraints，明确禁止的行为。

**设计要点**:
- 使用 `NEVER`, `STRICTLY PROHIBIT`, `MANDATORY` 等强约束词汇
- 针对常见错误模式
- 放在规则文件底部（利用 Recency Effect）

**示例**: `NEVER import UI frameworks from core layer` | `STRICTLY PROHIBIT comments that mirror code` | `MANDATORY: Use design tokens instead of hardcoded values`

## 实现模式 (Implementation Patterns)

### 核心价值

"负面禁令"告诉 AI "不要做什么"，"实现模式"告诉 AI "应该怎么做"。消除代码风格差异，提供标准答案，提高一次性通过率。

### 分级策略：高危区强制，低危区按需

**🔥 必须补充 (Must Have)**: 运行时安全、渲染性能、并发控制等高风险领域。提供代码模板（IPC 调用模式、组件骨架、Token 使用模式）

**🛡️ 推荐补充 (Nice to Have)**: 架构约束、数据一致性、依赖管理等中风险领域。提供标准结构示例（Headless Hook、Repository 模式）

**⚡ 不必强制 (Optional)**: 工程配置、文档维护、测试代码。纯文本规则通常已足够清晰

---

**相关文档**:
- [架构策略](./架构策略.md) - 模块化与关注点分离
- [交互协议](./交互协议.md) - 标准化与特权分级
- [治理模式](./治理模式.md) - 通用治理模式
- [维护与注意事项](./维护与注意事项.md) - 规则维护与实践指南

