# 环境配置

**核心原则：环境隔离 (Environment Isolation) · 编译时注入 (Compile-Time Injection) · 类型安全 (Type-Safe)**

## 环境区分

**规则**: 必须明确区分 Dev / Staging / Prod 环境，避免开发时连接生产库。

**实现方式**:
- 使用 `--dart-define` 编译时参数（推荐）
- 或使用 `flutter_dotenv` 加载 `.env` 文件

## 编译时配置

**规则**: 使用 `--dart-define` 在构建时注入环境变量。

**配置示例**:
```dart
// 构建命令
flutter build windows --dart-define=ENV=prod --dart-define=API_URL=https://api.example.com

// 代码中使用
const apiUrl = String.fromEnvironment('API_URL', defaultValue: 'http://localhost:3000');
const env = String.fromEnvironment('ENV', defaultValue: 'dev');
```

## ConfigService 设计

**实现位置**: `lib/core/config/app_config.dart`

**设计模式**:
```dart
class AppConfig {
  static const String apiUrl = String.fromEnvironment('API_URL');
  static const String sentryDsn = String.fromEnvironment('SENTRY_DSN');
  static const String env = String.fromEnvironment('ENV', defaultValue: 'dev');
  
  static bool get isProduction => env == 'prod';
  static bool get isDevelopment => env == 'dev';
}
```

## 环境变量管理

**必需变量**:
- `API_URL`: API 服务器地址
- `SENTRY_DSN`: Sentry 错误追踪 DSN（Prod 环境）
- `ENV`: 环境标识（dev/staging/prod）

**安全规则**:
- 敏感信息（如 API Key）使用 Secure Storage，不通过环境变量
- 环境变量仅用于非敏感配置

## CI/CD 集成

**GitHub Actions**:
```yaml
- name: Build
  run: flutter build windows --dart-define=ENV=prod --dart-define=API_URL=${{ secrets.API_URL }}
```

详见: [CI-CD](./CI-CD.md) | [构建工作流](./构建工作流.md)

