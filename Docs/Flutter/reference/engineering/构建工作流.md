# 构建工作流

**核心原则：构建即检查 (Check-on-Build) · 违规即失败 (Fail on Violation)**

> **架构守护**: 所有架构检查已集成到构建流程中，违规即构建失败。

## 核心工作流

我们采用了 **"构建即检查" (Check-on-Build)** 的策略。

| 场景 | 命令 | 包含动作 |
| :--- | :--- | :--- |
| **日常开发** | `flutter run` | 启动开发服务器 (Hot Reload) |
| **提交代码前** | `flutter analyze` | Dart 类型检查 + Lint 检查 + 架构依赖检查 |
| **生产构建** | `flutter build` | **自动执行所有检查** -> Flutter 构建 -> 代码混淆 |
| **快速构建** | `flutter build --debug` | 跳过混淆，用于测试环境 |

> **注意**: 严禁在 CI/CD 中使用 `--no-check`，该命令仅供调试构建脚本本身使用。

## 检查项详情

1. **Dart 分析**: `flutter analyze` - 确保类型安全和代码风格
2. **Linting**: `very_good_analysis` - 代码风格与最佳实践
3. **架构依赖检查**: 自定义 `analyzer` 插件 - **核心架构防线**
   - 确保 `domain/` 层不依赖 `flutter` 或 `riverpod`
   - 确保分层架构（Clean Architecture）不被穿透

## 常见违规及修复

| 违规类型 | 修复方法 |
|---------|---------|
| Domain 层导入了 Flutter | 移除 Flutter 依赖，使用纯 Dart 代码 |
| Data 层导入了 Presentation | 使用依赖注入或接口隔离 |
| 循环依赖 | 重构代码结构，打破循环 |
| 代码生成未运行 | 运行 `dart run build_runner build` |

详见: [代码生成](./代码生成.md) | [架构守护](./架构守护.md)


