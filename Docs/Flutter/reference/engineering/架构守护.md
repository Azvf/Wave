# 架构守护

**核心原则：工具强制 (Tool Enforcement) · 违规即失败 (Fail on Violation)**

> **架构守护**: 所有架构规则由工具强制执行，违规即构建失败。

## 架构守护配置

**实现位置**: `analysis_options.yaml`

```yaml
include: package:very_good_analysis/analysis_options.yaml

analyzer:
  plugins:
    - custom_lint
  errors:
    invalid_annotation_target: error
    avoid_relative_lib_imports: error

linter:
  rules:
    prefer_single_quotes: true
    avoid_print: true
    always_declare_return_types: true
```

## 自定义 Lint 规则

**实现位置**: `tool/custom_lint/` (自定义 Lint 插件)

**检查项**:
- Domain 层禁止导入 Flutter 包
- 乐观更新检测（Mutation 方法必须实现乐观更新）
- 硬编码检测（禁止魔法数字、颜色值等）

## 依赖检查

**规则**: 确保分层架构不被穿透

- `domain/` 层不依赖 `flutter` 或 `riverpod`
- `data/` 层不依赖 `presentation/`
- 禁止循环依赖

**工具**: 自定义 `analyzer` 插件

详见: [构建工作流](./构建工作流.md) | [CI-CD](./CI-CD.md)


