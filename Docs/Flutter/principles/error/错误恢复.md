# 错误恢复

**核心原则：自动重试 (Auto Retry) · 冲突解决 (Conflict Resolution) · 网络感知 (Network Awareness)**

## 网络错误恢复

**策略**: 自动重试（指数退避）

**实现**:
```dart
Future<T> retryWithBackoff<T>(Future<T> Function() operation, {int maxRetries = 3}) async {
  int attempt = 0;
  while (attempt < maxRetries) {
    try {
      return await operation();
    } catch (e) {
      if (e is NetworkException && attempt < maxRetries - 1) {
        await Future.delayed(Duration(seconds: 1 << attempt)); // 指数退避
        attempt++;
        continue;
      }
      rethrow;
    }
  }
  throw StateError('Max retries exceeded');
}
```

## 同步冲突恢复

**策略**: 显示冲突解决 UI

**实现**: 当检测到 `SyncException.conflict` 时，显示冲突解决对话框，让用户选择解决方案。

## 验证错误恢复

**策略**: 就地显示错误提示

**实现**: 在对应表单字段显示验证错误信息。

## 网络状态感知

**规则**: 应用在离线状态下变为 "Read-only" 视觉风格或显示 "Offline Mode" 指示器。

**实现**:
- 使用 `Connectivity` 监听网络状态
- 离线状态下允许继续操作，但需提示 "Changes will sync when online"

## 破坏性操作保护

**低风险删除**: 点击即删，但提供 "Undo" Toast。

**高风险删除**: 必须使用 Dialog 确认，甚至要求输入名称以确认。

详见: [错误分级](./错误分级.md) | [错误类型](./错误类型.md)


