# 错误类型

**核心原则：类型安全 (Type-Safe) · 统一转换 (Unified Conversion)**

> **架构守护**: 统一错误类型由 `sealed class` 强制类型安全。

## 统一错误类型定义

**规则**: 使用 `sealed class` 定义统一错误类型，确保类型安全。

**实现位置**: `lib/core/exceptions/app_exceptions.dart`

```dart
sealed class AppException implements Exception {
  final String message;
  final String? code;
  const AppException(this.message, {this.code});
}

class NetworkException extends AppException {
  final int? statusCode;
  factory NetworkException.timeout() => 
    const NetworkException('请求超时，请检查网络连接', code: 'TIMEOUT');
  factory NetworkException.offline() => 
    const NetworkException('网络已断开', code: 'OFFLINE');
}

class ValidationException extends AppException {
  final Map<String, String>? fieldErrors;
}

class SyncException extends AppException {
  final String? conflictId;
  factory SyncException.conflict(String conflictId) => 
    SyncException('数据冲突，需要解决冲突', code: 'CONFLICT', conflictId: conflictId);
}

class PermissionException extends AppException {}
class UnknownException extends AppException {
  final Object? originalError;
}
```

## 错误转换

**规则**: 所有底层错误（网络、数据库、文件系统）必须转换为 `AppException`。

**实现位置**: Repository 实现层

```dart
class TodoRepositoryImpl implements TodoRepository {
  Future<List<Todo>> getAll() async {
    try {
      return await apiClient.getTodos();
    } on DioException catch (e) {
      throw NetworkException('获取数据失败: ${e.message}', statusCode: e.response?.statusCode);
    } catch (e) {
      throw UnknownException('未知错误', originalError: e);
    }
  }
}
```

详见: [错误分级](./错误分级.md) | [错误恢复](./错误恢复.md)

