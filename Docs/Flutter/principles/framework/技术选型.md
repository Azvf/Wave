# 技术选型

## 核心技术栈

| 模块 | 选型 | 理由 |
| --- | --- | --- |
| **State Management** | **Riverpod (Generator)** | 编译时安全，无 Context 依赖，完美契合分层架构 |
| **Navigation** | **GoRouter** | 处理桌面端 Deep Link 和复杂路由栈的最佳选择 |
| **Local DB** | **Isar** | 极速、强类型、跨平台友好，优于 Sqflite |
| **Network** | **Dio + Retrofit** | 代码生成 API 客户端，减少样板代码 |
| **Codegen** | **Freezed** | 强制不可变数据模型 (Immutable)，杜绝状态修改 bug |
| **Window Management** | **window_manager** | 跨平台窗口管理，支持持久化状态 |
| **Linting** | **very_good_analysis** | 严格的代码风格和最佳实践检查 |
| **Secure Storage** | **flutter_secure_storage** | 安全存储（Keychain/Windows Credential Manager） |
| **Auto Updater** | **sparkle** (macOS) / **自建服务** | 自动更新机制 |
| **Logging** | **logger** + **Sentry** | 结构化日志和远程遥测 |
| **Testing** | **golden_toolkit** + **mocktail** | 视觉回归测试和 Mock 工具 |

## 项目结构

```
lib/
├── core/                  # 核心基础设施 (无业务逻辑)
│   ├── theme/             # Design Tokens (ThemeExtension)
│   ├── router/            # GoRouter 配置
│   ├── exceptions/        # 统一错误定义
│   ├── sync/              # 同步服务 (SyncService)
│   └── utils/             # 窗口工具, 键盘监听
├── features/              # 业务模块 (Feature-First)
│   └── editor/
│       ├── data/          # Repository Impl
│       ├── domain/        # Entity, Repository Interface
│       └── presentation/  # Widgets, Riverpod Providers
└── main.dart
```

## Riverpod 使用规范

### Provider 分类
- **FutureProvider**: 异步数据获取
- **StreamProvider**: 流式数据（如 Isar 查询流）
- **StateNotifierProvider**: 复杂状态管理
- **Provider**: 简单值或服务

### 命名规范
- Provider 名称必须以 `Provider` 结尾
- 使用 `@riverpod` 注解自动生成代码

## Desktop 特定插件

### 跨平台兼容性

| 插件 | Windows | macOS | 说明 |
| --- | --- | --- | --- |
| **window_manager** | ✅ | ✅ | 窗口管理，全平台支持 |
| **flutter_secure_storage** | ✅ | ✅ | 安全存储（自动处理） |
| **sparkle** | ❌ | ✅ | macOS 自动更新（推荐） |
| **msix** | ✅ | ❌ | Windows 应用包格式 |

### 安全存储配置

- **macOS**: Keychain（自动处理）
- **Windows**: Windows Credential Manager（自动处理）

详见: [Repository模式](./Repository模式.md) | [代码组织](./代码组织.md) | [发布指南](../reference/engineering/发布指南.md)


