# 窗口管理

**核心原则：持久化 (Persistent) · 融合式 (Immersive) · 单窗口 (Single Window)**

> **架构守护**: 窗口管理规则由 `window_manager` 包强制执行。

## 持久化状态

**规则**: MVP 必须记住用户上次关闭时的窗口大小、位置和最大化状态。

**实现**:
- 使用 `window_manager` + `shared_preferences` 持久化窗口状态
- 应用启动时自动恢复窗口位置和大小

**实现位置**: `lib/core/utils/window_manager.dart`

## 自定义标题栏

**规则**: 隐藏原生系统栏，实现融合式（Immersive）标题栏，以匹配设计风格。

**实现**:
- 使用 `window_manager` 隐藏原生标题栏
- 自定义 `AppBar` 实现标题栏功能（最小化、最大化、关闭）

**注意事项**:
- Windows/macOS 的窗口控制按钮位置不同，需要适配
- 拖拽区域必须明确（通常为标题栏区域）

## 多窗口策略

**规则**: MVP 阶段**严禁**使用多窗口（Isolate 通信成本高），尽量使用 `Dialog`、`Overlay` 或 `SidePanel` 解决交互。

**替代方案**:
- **模态对话框**: 使用 `showDialog` 显示临时任务
- **侧边栏**: 使用 `Drawer` 或自定义 `SidePanel` 显示辅助信息
- **覆盖层**: 使用 `Overlay` 显示浮动面板

**后续扩展**: 如需多窗口支持，使用 Isolate 通信抽象层（预留扩展点）。

详见: [键盘优先](./键盘优先.md) | [鼠标交互](./鼠标交互.md)


