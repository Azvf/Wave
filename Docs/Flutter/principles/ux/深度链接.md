# 深度链接与路由状态

**核心原则：状态恢复 (State Restoration) · URL Scheme (URL Scheme) · 文件关联 (File Association)**

## GoRouter 深度链接

**规则**: 使用 GoRouter 处理深度链接和 URL Scheme。

**实现位置**: `lib/core/router/app_router.dart`

**配置示例**:
```dart
final router = GoRouter(
  routes: [
    GoRoute(
      path: '/todo/:id',
      builder: (context, state) => TodoDetailPage(id: state.pathParameters['id']!),
    ),
  ],
);
```

## URL Scheme 处理

**规则**: 桌面端支持通过 URL Scheme 唤起应用。

**场景**:
- 浏览器点击 `myapp://todo/123` 打开应用
- 其他应用通过 URL Scheme 调用

**实现**: 在 `main.dart` 中注册 URL Scheme 处理器。

## 路由状态恢复

**规则**: 应用关闭后重新打开，应恢复到上次的路由状态。

**策略选择**:
- **恢复策略**: 记住上次路由，重新打开时恢复（适合桌面端）
- **重置策略**: 每次打开都回到首页（适合移动端）

**实现**: 使用 `SharedPreferences` 存储最后路由路径，启动时恢复。

## 文件关联

**规则**: 桌面端支持通过双击文件打开应用。

**实现**:
- Windows: 注册文件类型关联（`.myapp`）
- macOS: 在 `Info.plist` 中配置 `CFBundleDocumentTypes`

**处理**: 应用启动时检查命令行参数，解析文件路径并导航到相应页面。

详见: [窗口管理](./窗口管理.md) | [键盘优先](./键盘优先.md)

